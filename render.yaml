services:
  # Platform API
  - type: web
    name: workforce-api
    runtime: node
    rootDir: platform
    buildCommand: npm install --include=dev && npm run build
    startCommand: npm run start
    envVars:
      - key: PORT
        value: 3000
      - key: TENANT_DATA_DIR
        value: /data/tenants
      - key: NODE_ENV
        value: production
      - key: CLAWDBOT_GATEWAY_HOST
        fromService:
          name: workforce-gateway
          type: web
          property: host
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: DATABASE_URL
        sync: false
      - key: OPENROUTER_API_KEY
        sync: false
      - key: CLAWDBOT_HOOK_TOKEN
        sync: false
      - key: DEFAULT_MODEL
        value: google/gemini-3-pro-preview
    disk:
      name: tenant-data
      mountPath: /data
      sizeGB: 1

  # Clawdbot Gateway
  - type: web
    name: workforce-gateway
    runtime: node
    rootDir: clawdbot
    buildCommand: npm i -g pnpm@10 && pnpm install && pnpm build
    startCommand: node moltbot.mjs gateway --port $PORT --bind lan
    envVars:
      - key: NODE_ENV
        value: production
      - key: MOLTBOT_STATE_DIR
        value: /opt/render/project/.moltbot
      - key: MOLTBOT_CONFIG_PATH
        value: /opt/render/project/moltbot.production.json
      - key: CLAWDBOT_GATEWAY_TOKEN
        sync: false
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: OPENROUTER_API_KEY
        sync: false
